<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´ä¿®å¤éªŒè¯ - Past Conferences</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="frontend/css/anti-flicker.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .status-card {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        .status-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 4px solid #28a745;
        }
        .status-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border-left: 4px solid #17a2b8;
        }
        .conferences-slider {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .fix-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        .fix-badge.done {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">
                <i class="fas fa-check-double text-green-500 mr-3"></i>
                å®Œæ•´ä¿®å¤éªŒè¯
            </h1>
            <p class="text-gray-600 text-lg">Past Conferences é—ªçƒé—®é¢˜ - ä¸‰å±‚é˜²æŠ¤æ–¹æ¡ˆ</p>
        </div>

        <!-- Fix Summary -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="status-card status-success">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-green-700 font-medium mb-1">æ•°æ®å±‚ä¿®å¤</p>
                        <p class="text-xl font-bold text-green-800">image_url å­—æ®µ</p>
                        <span class="fix-badge done">âœ“ å·²æ·»åŠ </span>
                    </div>
                    <i class="fas fa-database text-4xl text-green-600"></i>
                </div>
            </div>
            <div class="status-card status-success">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-green-700 font-medium mb-1">é€»è¾‘å±‚ä¿®å¤</p>
                        <p class="text-xl font-bold text-green-800">é¢„è®¡ç®— + Fragment</p>
                        <span class="fix-badge done">âœ“ å·²ä¼˜åŒ–</span>
                    </div>
                    <i class="fas fa-code text-4xl text-green-600"></i>
                </div>
            </div>
            <div class="status-card status-success">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-green-700 font-medium mb-1">è¡¨ç°å±‚ä¿®å¤</p>
                        <p class="text-xl font-bold text-green-800">Anti-Flicker CSS</p>
                        <span class="fix-badge done">âœ“ å·²åº”ç”¨</span>
                    </div>
                    <i class="fas fa-paint-brush text-4xl text-green-600"></i>
                </div>
            </div>
        </div>

        <!-- Fix Details -->
        <div class="status-card status-info mb-6">
            <h2 class="text-xl font-bold text-blue-900 mb-3">
                <i class="fas fa-tools mr-2"></i>
                ä¿®å¤å†…å®¹
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold text-blue-800 mb-2">é—®é¢˜æ ¹æº</h3>
                    <ul class="space-y-1 text-sm text-blue-700">
                        <li><i class="fas fa-times-circle text-red-500 mr-2"></i>æ•°æ®åº“ç¼ºå°‘ image_url å­—æ®µ</li>
                        <li><i class="fas fa-times-circle text-red-500 mr-2"></i>å›¾ç‰‡åŠ è½½å¤±è´¥è§¦å‘ onerror</li>
                        <li><i class="fas fa-times-circle text-red-500 mr-2"></i>æ¸²æŸ“æ—¶è¿›è¡Œæ—¶åŒºè½¬æ¢</li>
                        <li><i class="fas fa-times-circle text-red-500 mr-2"></i>DOMå¤šæ¬¡æ›´æ–°é€ æˆé‡ç»˜</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-blue-800 mb-2">è§£å†³æ–¹æ¡ˆ</h3>
                    <ul class="space-y-1 text-sm text-blue-700">
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>æ·»åŠ  image_url åˆ—åˆ°æ•°æ®åº“</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>é¢„è®¡ç®—æ‰€æœ‰æ—¥æœŸå’Œæ ¼å¼</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>ä½¿ç”¨ DocumentFragment æ‰¹é‡æ›´æ–°</li>
                        <li><i class="fas fa-check-circle text-green-500 mr-2"></i>CSS é˜²é—ªçƒä¿æŠ¤å±‚</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Live Test -->
        <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">
                <i class="fas fa-users text-purple-600 mr-2"></i>
                å®æ—¶æµ‹è¯• - Past Conferences
            </h2>
            <p class="text-gray-700 mb-4">
                è§‚å¯Ÿä¸‹æ–¹å¡ç‰‡åŠ è½½è¿‡ç¨‹ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
                <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded text-sm ml-2">
                    âœ“ æ—¥æœŸæ–‡å­—ç¨³å®šæ˜¾ç¤º
                </span>
                <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded text-sm ml-2">
                    âœ“ å›¾ç‰‡å¹³æ»‘æ·¡å…¥
                </span>
                <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded text-sm ml-2">
                    âœ“ æ— å¸ƒå±€è·³åŠ¨
                </span>
            </p>
            <div class="conferences-slider" id="conferences-container">
                <!-- Conferences will be loaded here -->
            </div>
        </div>

        <!-- Verification Steps -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
            <div class="flex items-start">
                <i class="fas fa-lightbulb text-yellow-600 text-2xl mr-3 mt-1"></i>
                <div>
                    <h3 class="font-bold text-yellow-800 mb-2">éªŒè¯æ­¥éª¤</h3>
                    <ol class="list-decimal list-inside space-y-1 text-yellow-700 text-sm">
                        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)</li>
                        <li>åˆ‡æ¢åˆ° Network æ ‡ç­¾</li>
                        <li>ç‚¹å‡»ä¸‹æ–¹çš„"é‡æ–°åŠ è½½"æŒ‰é’®</li>
                        <li>è§‚å¯Ÿå›¾ç‰‡æ˜¯å¦æˆåŠŸåŠ è½½ï¼ˆçŠ¶æ€ç  200ï¼‰</li>
                        <li>è§‚å¯Ÿæ—¥æœŸæ–‡å­—æ˜¯å¦ç¨³å®šæ˜¾ç¤º</li>
                        <li>å¤šæ¬¡åˆ·æ–°éªŒè¯ä¸€è‡´æ€§</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 mt-6">
            <button onclick="location.reload()" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                <i class="fas fa-redo mr-2"></i>é‡æ–°åŠ è½½æµ‹è¯•
            </button>
            <button onclick="window.open('http://localhost', '_blank')" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                <i class="fas fa-external-link-alt mr-2"></i>æ‰“å¼€å®é™…ç½‘ç«™
            </button>
        </div>
    </div>

    <script type="module">
        import { ConferencesAPI } from './frontend/js/api-client.js';
        import { formatDateRange } from './frontend/js/timezone-utils.js';

        async function testConferences() {
            const container = document.getElementById('conferences-container');
            
            try {
                container.innerHTML = `
                    <div class="col-span-full flex flex-col justify-center items-center py-20">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mb-4"></div>
                        <p class="text-gray-600 font-medium">æ­£åœ¨åŠ è½½ Past Conferences...</p>
                    </div>
                `;

                const response = await ConferencesAPI.getPast();
                const conferences = response.data || [];

                if (conferences.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-10 text-gray-500">
                            <i class="fas fa-users text-5xl mb-3"></i>
                            <p class="text-lg">æš‚æ— è¿‡å¾€ä¼šè®®æ•°æ®</p>
                        </div>
                    `;
                    return;
                }

                // é¢„è®¡ç®—æ‰€æœ‰æ•°æ®ï¼ˆé˜²é—ªçƒå…³é”®æ­¥éª¤ï¼‰
                const conferencesWithData = conferences.map(conf => ({
                    ...conf,
                    dateRangeDisplay: (conf.start_date && conf.end_date)
                        ? formatDateRange(conf.start_date, conf.end_date)
                        : (conf.date_range || 'Date TBD')
                }));

                // ä½¿ç”¨ DocumentFragment æ‰¹é‡æ¸²æŸ“
                const fragment = document.createDocumentFragment();
                const tempDiv = document.createElement('div');
                
                tempDiv.innerHTML = conferencesWithData.map(conf => {
                    const imageUrl = conf.image_url || 'https://images.unsplash.com/photo-1517245386807-6c03e2ca1dba?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
                    const truncatedTitle = conf.title.length > 60 ? conf.title.substring(0, 60) + '...' : conf.title;
                    
                    return `
                        <article class="conference-card bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 group">
                            <div class="conference-img h-[220px] overflow-hidden relative">
                                <img src="${imageUrl}" alt="${conf.title}" 
                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" 
                                    onerror="this.src='https://images.unsplash.com/photo-1517245386807-6c03e2ca1dba?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                            </div>
                            <div class="conference-content p-6">
                                <span class="conference-date text-gray-500 text-sm font-medium mb-3 block">
                                    <i class="far fa-calendar mr-1"></i>
                                    ${conf.dateRangeDisplay}
                                </span>
                                <h3 class="text-lg font-bold text-gray-900 mb-4 leading-tight line-clamp-2">
                                    ${truncatedTitle}
                                </h3>
                                <a href="#conference-detail-${conf.id}" class="inline-flex items-center text-gray-600 hover:text-purple-600 font-medium text-sm transition-colors">
                                    Learn More <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                                <div class="mt-4 pt-4 border-t-2 border-gradient-to-r from-purple-500 to-blue-500"></div>
                            </div>
                        </article>
                    `;
                }).join('');

                while (tempDiv.firstChild) {
                    fragment.appendChild(tempDiv.firstChild);
                }

                // å•æ¬¡DOMæ›´æ–°
                container.innerHTML = '';
                container.appendChild(fragment);

                // å›¾ç‰‡åŠ è½½çŠ¶æ€ç®¡ç†
                const images = container.querySelectorAll('img');
                images.forEach(img => {
                    if (img.complete) {
                        img.classList.add('loaded');
                    } else {
                        img.addEventListener('load', () => {
                            img.classList.add('loaded');
                        });
                        img.addEventListener('error', () => {
                            img.classList.add('loaded');
                        });
                    }
                });

                container.classList.add('loaded');

                console.log('âœ… Conferences æ¸²æŸ“å®Œæˆï¼Œæ— é—ªçƒï¼');
                console.log(`ğŸ“Š åŠ è½½äº† ${conferences.length} ä¸ªä¼šè®®`);
                console.log('ğŸ–¼ï¸ æ‰€æœ‰å›¾ç‰‡URL:', conferences.map(c => c.image_url));

            } catch (error) {
                console.error('âŒ åŠ è½½å¤±è´¥:', error);
                container.innerHTML = `
                    <div class="col-span-full bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg text-center">
                        <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                        <p class="font-medium mb-1">åŠ è½½å¤±è´¥</p>
                        <p class="text-sm">${error.message || 'è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ'}</p>
                    </div>
                `;
            }
        }

        // è¿è¡Œæµ‹è¯•
        testConferences();
    </script>
</body>
</html>
